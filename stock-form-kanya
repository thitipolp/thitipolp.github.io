// This is the name of the sheet in your Google Sheet file.
const SHEET_NAME = "Sheet1";

// This function runs when a POST request is made to the script's URL.
function doPost(e) {
  try {
    const doc = SpreadsheetApp.getActiveSpreadsheet();
    const sheet = doc.getSheetByName(SHEE_NAME);
    
    // The incoming data is a JSON string in the request body.
    const requestData = JSON.parse(e.postData.contents);
    const items = requestData.items; // This is the array of items from the form

    // Check if there are any items to add
    if (!items || items.length === 0) {
      throw new Error("No items received.");
    }
    
    const timestamp = new Date();

    // Loop through each item sent from the form and append it as a new row
    items.forEach(item => {
      const newRow = [
        timestamp,
        item.category,
        item.sku,
        item.description,
        item.quantity,
        item.unit
      ];
      sheet.appendRow(newRow);
    });

    // Return a success response.
    return ContentService
      .createTextOutput(JSON.stringify({ "result": "success", "itemsAdded": items.length }))
      .setMimeType(ContentService.MimeType.JSON);

  } catch (error) {
    // If an error occurs, log it and return an error response.
    Logger.log(error);
    return ContentService
      .createTextOutput(JSON.stringify({ "result": "error", "error": error.message }))
      .setMimeType(ContentService.MimeType.JSON);
  }
}